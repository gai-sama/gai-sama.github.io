/** Created by ck on 2016/6/21. */
!function(){var G="cjds-web";if(/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)){G="cjds-ios"}else{if(/(Android)/i.test(navigator.userAgent)){G="cjds-android"}}var B=document.getElementsByTagName("input");for(var z=0;z<B.length;z++){B[z].value="";B._valid=false}var v=document.getElementById("identity"),f=document.getElementById("down-btn"),h=document.getElementById("options"),E=document.getElementById("img-code"),A=document.getElementById("code-img"),d=document.getElementById("code-btn"),x=document.getElementById("phone"),e=document.getElementById("msg-code"),F=document.getElementById("register-btn"),k=document.getElementById("password"),u=document.getElementById("agree"),C=document.getElementById("checkbox"),a=document.getElementById("tips");var n=a.getElementsByTagName("span")[0];document.onclick=m;v.onclick=l;f.onclick=l;h.onclick=D;F.onclick=j;var w="";x._reg=/^(0|86|17951)?(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/;E._reg=/^[0-9a-zA-Z]{5,}$/;e._reg=/^[0-9a-zA-Z]+$/;k._reg=/^.+$/;x.oninput=q;E.oninput=q;e.oninput=q;k.oninput=q;A.onclick=b;d.onclick=p;C._valid=true;u.onchange=function(){C._valid=u.checked;g()};b();function q(){w=this.value;this._valid=!!w.match(this._reg);g()}function l(i){i=i||window.event;i.stopPropagation();if(f.className==="active"){h.style.display="none";f.className=""}else{h.style.display="block";f.className="active"}}function m(){h.style.display="none";f.className=""}function D(i){i=i||window.event;i.stopPropagation();var H=i.target||i.srcElement;v.value=H.innerHTML;v._realValue=H.id;v.className="active";h.style.display="none";f.className="";v._valid=true;g()}function b(i,H){E._valid=false;if(!!E.value){E.focus();E.value=""}A.src="http://www.weiruict.com/cjds/pcode?ver="+Math.random();t(H?H:"")}function p(){if(d.timer){return false}if(!x._valid){t("错误的手机号");x.focus();x.select();document.body.scrollTop=(document.body.scrollHeight-document.body.clientHeight);return false}if(!E._valid){t("图片验证码格式错误");E.focus();E.select();document.body.scrollTop=(document.body.scrollHeight-document.body.clientHeight);return false}s(60);y("/cjds/register/sendCode","post",{"mobile":x.value,"securityCode":E.value},function(H){var i=JSON.parse(H);if(i.success){d._valid=true;g()}else{if(i.code==-103){b(null,"验证码错误")}else{t(i.errMsg)}window.clearInterval(d.timer);d.innerHTML="获取验证码";d.timer=null}})}function g(i){t(i?i:"");F.className=d._valid&&v._valid&&x._valid&&E._valid&&e._valid&&k._valid&&C._valid?"active":""}var r=null;function t(i){if(i){n.innerHTML=i;window.clearTimeout(r);r=c(3,150)}else{a.style.opacity="0";n.innerHTML=""}}var o=null;function c(H,i){window.clearInterval(o);a.style.opacity=a.style.opacity==="1"?"0":(H--&&"1");o=window.setInterval(function(){H<1?window.clearInterval(o):a.style.opacity=a.style.opacity==="1"?"0":(H--&&"1")},i)}function s(i){d.innerHTML="重新发送 ("+(i--)+"s)";d.timer=window.setInterval(function(){if(!i){window.clearInterval(d.timer);d.innerHTML="获取验证码";d.timer=null}else{d.innerHTML="重新发送 ("+(i--)+"s)"}},1000)}function j(){if(F.className!="active"){switch(true){case !v._valid:t("请选择您的身份");break;case !x._valid:x.focus();t("请检查手机号");break;case !E._valid:E.focus();t("请检查图片验证码");break;case !d._valid:t("请先发送短信验证码");break;case !e._valid:e.focus();t("请检查短信验证码");break;case !k._valid:t("请检查密码");break;case !C._valid:t("请阅读《场景大师使用协议》");break}document.body.scrollTop=(document.body.scrollHeight-document.body.clientHeight)}else{var i={"identity":parseInt(v._realValue.replace("op_","")),"mobile":x.value,"code":e.value,"pwd1":k.value,"pwd2":k.value,"origin":G};y("/cjds/register","post",i,function(I){var H=JSON.parse(I);if(H.success){window.location.assign("register_success.html")}else{t(H.errMsg)}})}}function y(i,H,N,M,I){var L=null;if(window.XMLHttpRequest){L=new XMLHttpRequest()}else{if(window.ActiveXObject){L=new ActiveXObject("Microsoft.XMLHTTP")}}if(L!=null){var K="";if(N){for(var J in N){if(N.hasOwnProperty(J)){K+=(J+"="+N[J]+"&")}}K=K.replace(/^(.*)&$/,"$1")}L.onreadystatechange=function(){if(L.readyState==4){L.status==200?M&&M(L.responseText):I&&I(L)}};if(H.toLowerCase()=="get"){i+="?"+K;L.open(H,i,true);L.send(null)}else{if(H.toLowerCase()=="post"){L.open(H,i,true);L.setRequestHeader("Content-type","application/x-www-form-urlencoded");L.send(K)}}}else{console.error("您的浏览器不支持XMLHTTP。")}}}();